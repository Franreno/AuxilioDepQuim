SELECT A.NOME,C.NOME,R.PRESENCA 
FROM REABILITACAO R 
JOIN AUXILIADO A 
ON R.DEPENDENTE = A.CPF 
JOIN CLINICA C 
ON R.CLINICA = C.CNPJ 
WHERE(SELECT AVG(a.PRESENCA) FROM REABILITACAO A) < r.PRESENCA;   


SELECT T.NOME, EP.NUFUNCIONARIOS, ES.LOCAL
FROM TERCEIROS T
JOIN EMPREGO_SUPERVISIONADO ES
ON T.NUCPFCNPJ = ES.EMPRESA_PARCEIRA
JOIN EMPRESAS_PARCEIRAS EP
ON ES.EMPRESA_PARCEIRA = EP.CNPJ
WHERE EP.MAXFUNCIONARIOS > EP.NUFUNCIONARIOS;

SELECT A.NOME,
CASE 
    WHEN  ES.DURACAO - CURRENT_DATE < 10 AND ES.DURACAO - CURRENT_DATE > 0
        THEN 'PROXIMO AO FIM'
    WHEN ES.DURACAO- CURRENT_DATE > 10 
        THEN 'FUNCIONARIO EMPREGADO'
    WHEN (ES.DURACAO - CURRENT_DATE < 0) OR ES.DURACAO IS NULL
        THEN 'FUNCIONARIO DESEMPREGADO'
    END STATUS_EMPREGO
FROM AUXILIADO A
LEFT JOIN EMPREGO_SUPERVISIONADO ES
ON A.CPF = ES.AUXILIADO
LEFT JOIN TERCEIROS E
ON ES.EMPRESA_PARCEIRA = E.NUCPFCNPJ;

select * from AUXILIADO A JOIN EMPREGO_SUPERVISIONADO ES
on A.CPF = ES.AUXILIADO;

-- Selecionar os centros comunitários e quantos auxiliados ele subsidia através da tesouraria;
SELECT C.NOME, COUNT(*) FROM
    CENTRO C JOIN TESOURARIA T
    ON C.CNPJ = T.CENTRO
    JOIN AUXILIADO A  
    ON A.FRENTE = T.FRENTE AND  T.CENTRO = A.CENTRO
    GROUP BY C.NOME;


-- Selecionar todos os auxiliados que são apenas moradores de rua;
SELECT A.NOME, A.LOCAL FROM
    AUXILIADO A JOIN TIPO_AUXILIADO TA
    ON A.CPF = TA.CPF
    WHERE A.CPF NOT IN
    (SELECT DISTINCT A.CPF FROM 
        AUXILIADO A JOIN TIPO_AUXILIADO TA
        ON A.CPF = TA.CPF
        WHERE TA.TIPO = 'DEPENDENTE_QUIMICO');
